name: Java CI
 
on:
  push:
    branches: 
      - main

jobs:
  build: 
    runs-on: ubuntu-latest

    steps:  
      - name: Checkout code
        uses: actions/checkout@v3 

      - name: Set up JDK 11
        uses: actions/setup-java@v3
        with:
         java-version: 11
         distribution: adopt


      - name: Build with Maven
        run: mvn clean install

      - name: Run tests
        run: mvn test -Dtest=CalculatorTest
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Java
        uses: actions/setup-java@v3
        with:
          java-version: 11
          distribution: adopt
 
      - name: Build and test
        run: |
          mvn clean install

      - name: Set up Git
        run: |
          git config --global user.name "Sreevaishnavisadhasivam"
          git config --global user.email "sreevaishnavi2002@gmail.com"

      - name: Check if remote origin exists
        run: |
          if ! git remote show origin; then
            git remote add origin "https://github.com/Sreevaishnavisadhasivam/test.git"
          else
            git remote set-url origin "https://github.com/Sreevaishnavisadhasivam/test.git"
          fi
          
      - name: Deploy to gh-pages
        env:
         ACCESS_TOKEN: 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
        run: |
          # Add commands to build and deploy your website
          # For example, if your built artifacts are in the 'target' directory
          cp -R target/* dist/
        
          if ! git show-ref --quiet refs/heads/gh-pages; then
          # Create the gh-pages branch
          git checkout --orphan gh-pages
          git rm -rf .
          echo "My GitHub Page" > index.html
          git add index.html
          git commit -m "Create gh-pages branch"
          git push origin gh-pages
          else
          # Switch to the existing gh-pages branch
          git checkout gh-pages
          fi

          # Commit and push the changes to gh-pages
          git add .
          git commit -m "Deploy new version"
          git push origin gh-pages


      


  
     

     
